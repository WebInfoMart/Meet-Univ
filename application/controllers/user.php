<?php if (!defined('BASEPATH')) exit('No direct script access allowed');class User extends CI_Controller{	function __construct()	{		parent::__construct();		// $data['base'] = $this->config->item('base_url');		// $data['css'] = $this->config->item('css_path');		// $data['css'] = $this->config->item('img_path');		$this->load->helper(array('form', 'url'));		$this->load->library('form_validation');		//$this->ci->load->config('tank_auth', TRUE);		//$this->ci->load->library('session');		$this->load->library('security');		$this->load->helper('url');		$this->load->library('tank_auth');		$this->lang->load('tank_auth');		$this->load->helper('string');		$this->load->library('email');		$this->ci =& get_instance();		$this->load->library('fbConn/facebook');	}	function index()	{		$data = $this->path->all_path();			$data['gallery_home'] = $this->users->fetch_home_gallery();		$data['country'] = $this->users->fetch_country();		$data['area_interest'] = $this->users->fetch_program();		/*  Upload code end */		$this->load->view('auth/header',$data);		$this->load->view('auth/home',$data);		$this->load->view('auth/footer',$data);	}		/* Code for user inbox */	function inbox($id='')	{		$data = $this->path->all_path();		$this->load->view('auth/header',$data);		//$this->load->view('welcome');		if (!$this->tank_auth->is_logged_in()) {			redirect('/login/');		} else {			$data['user_id']	= $this->tank_auth->get_user_id();			$data['username']	= $this->tank_auth->get_username();			$logged_user = $data['user_id'];			$this->load->model('users');			$data['fetch_profile'] = $this->users->fetch_profile($logged_user);			$data['query'] = $this->users->fetch_all_data($logged_user);			$data['profile_pic'] = $this->users->fetch_profile_data($logged_user); 		//	print_r($data['profile_pic']);			$data['educ_level'] = $this->users->fetch_educ_level();			$data['country'] = $this->users->fetch_country();			//print_r($data['country']);			$data['area_interest'] = $this->users->fetch_area_interest();			$data['inbox_messages'] = $this->users->inbox_message($logged_user);			$data['send_msg_via_reply'] = 0;			$data['error_send_msg_via_reply'] = 0;			//print_r($data['inbox_messages']);			if($id != '')			{				$message_condition = array(				'recipent_id'=> $logged_user,				'id'=> $id				);				$data['message_full'] = $this->users->fetch_message_by_id($message_condition);				if($this->input->post('btn_msg_reply'))				{					$this->form_validation->set_rules('msg_sub','Subject','trim|required|xss_clean');					$this->form_validation->set_rules('msg_body','Message','trim|required|xss_clean');					if($this->form_validation->run())					{						$sender_id = $data['message_full']['sender_id'];						$recipent_id = $data['message_full']['recipent_id'];												$send_msg_reply = array(						'recipent_id'=> $sender_id,						'sender_id'=> $recipent_id,						'subject'=> $this->input->post('msg_sub'),						'body'=> $this->input->post('msg_body'),						);						$data['send_msg_via_reply'] = $this->users->send_message_to_user($send_msg_reply);					}					else{					$errors = $this->tank_auth->get_error_message();					foreach ($errors as $k => $v)	$data['errors'][$k] = $this->lang->line($v);					$data['error_send_msg_via_reply'] = 1;					}				}				if($data['message_full'] != 0)				{					$sender_id = $data['message_full']['sender_id'];					$data['get_sender_email'] = $this->users->get_sender_email($sender_id);					//print_r($data['get_sender_email']);				}				$this->load->view('user/message_open',$data);			}			else{					$this->load->view('user/inbox',$data);				}		$this->load->view('auth/footer',$data);		}	}	/* inbox code end here */		/* Code for delete inbox message */	function delete_message_inbox($msg_id='')	{		$data['user_id']	= $this->tank_auth->get_user_id();		$data['username']	= $this->tank_auth->get_username();		$logged_user = $data['user_id'];				$msg_del_cond = array(		'id'=> $msg_id,		'recipent_id' => $logged_user		);		if($this->input->post('del_multi_msg'))		{			$del_msg_ids = $this->input->post('msg');			foreach($del_msg_ids as $id)			{			$msg_del_cond = array(			'id'=> $id,			'recipent_id' => $logged_user			);			$data['delete_multiple_message_status'] = $this->users->delete_single_message_inbox($msg_del_cond);			}		}		else{		$data['delete_single_message_status'] = $this->users->delete_single_message_inbox($msg_del_cond);		}		redirect('inbox');		// if($data['delete_single_message_status'] == 1)		// {			// redirect('inbox/delmsg_suc');		// }		// else		// {			// redirect('inbox/delmsg_fail');		// }	}		}